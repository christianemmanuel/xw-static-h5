<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>东赢 - 电竞、体育每月投注皆有礼，多种礼品等你领！</title>
    <link rel="stylesheet" href="/style/plugins/bootstrap/css/bootstrap.min.css">
    <link href="/mui/css/mui.min.css" rel="stylesheet" />
    <link href="/mui/css/mui-icons-extra.css" rel="stylesheet" />
    <link href="/style/css/main.css" rel="stylesheet" />
    <link href="/style/css/index.css" rel="stylesheet" />
    <link rel="stylesheet" href="/style/css/esportsGift.css">

    <script type="text/javascript" src="/style/js/adaptive.js"></script>
    <script type="text/javascript" src="/style/js/jquery-3.2.1.min.js"></script>
    <script src="/style/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/style/js/common.js"></script>
    <script type="text/javascript" src="/mui/js/mui.min.js"></script>
    <script type="text/javascript" src="/style/js/lodash.js"></script>
    <script src="/style/plugins/tweenMax/TweenMax.min.js" type="text/javascript" ></script>
    <script type="text/javascript" src="/style/js/jquery.cookie.js"></script>
</head>
<body>
    <header class="mui-bar mui-bar-nav" style="padding-left: 15px;padding-right: 15px;display: none;">
        <a class="mui-icon mui-icon-left-nav mui-pull-left" style="text-decoration: none; color: white;"></a>
        <h1 class="mui-title" style="color: #ffffff;">电竞/体育投注有礼</h1>
    </header>
    <div class="esports-gift-container">
        <div class="top-banner"></div>
        <div style="width: 9.222rem;margin: -3rem auto 0;">
            <div class="progress-bar-container">
                <div class="member-bet-box">
                    <div style="width: 100px;"><span class="member-valid-bet">0.00</span>元</div>
                    <div class="dsj"></div>
                </div>
                <div class="progress-bar-box">
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                    <div class="progress-bar-item"></div>
                </div>
                <div class="progress-down-box">
                    <div class="progress-down-item-large"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-large"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-large"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-large"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-large"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-large"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-small"></div>
                    <div class="progress-down-item-large"></div>
                    <div style="position: absolute;top: 10px;">0</div>
                    <div style="position: absolute;right: 0;top: 10px;">5000000</div>
                </div>
                <div style="margin: 15px 0 25px 0px;color: #596281;">
                    注：流水只统计东赢电竞/体育，IM电竞/体育，RG电竞总流水。
                    <div class="exchange-btn exchange-record-btn active">兑换记录</div>
                </div>
            </div>
            <div class="title">活动礼品</div>
            <div class="gift-container">

            </div>
            <p class="title">活动时间</p>
            <p style="margin: 0.35rem 0.6rem;">2020年2月1日起</p>
            <p class="title">活动要求</p>
            <div class="rule-content-container">
                <ul class="rule-list">
                    <li>当月电竞/体育有效投注额：在自然月期间，电竞/体育场馆中月累计的有效投注额满足相应的领取条件即可领取对应档次的礼品一次。本活动一个月只能申请一次，如若领取成功不可更换。</li>
                    <li>所有电竞/体育赔率均为欧洲盘/香港盘，且投注赔率低于1.70/0.7和无效的、取消的、同局中对冲投注将不计算在有效投注内。</li>
                    <li>领取时间：活动期间内只要满足领取礼品条件，即可在活动页面自助申请礼品，如逾期没有领取视为放弃礼品。</li>
                    <li>领取方式：会员在满足对应的条件后即可在活动页面点击“立即兑换”自助领取，根据页面提示填写收货人姓名、收货地址及手机号码，相关工作人员会按照申请顺序进行审核，礼品的审核状态可在我的-“奖品记录”进行追踪，审核通过后东赢会依次发放礼品，礼品将在5个作日内进行派发，实际收到时间以快递公司为准。</li>
                    <li>东赢仅对已结算并产生输赢结果的投注额进行计算，任何平局、取消的赛事将不计算在有效投注。</li>
                    <li>每位有效玩家、每一手机号码、电子邮箱、相同银行卡、每一个IP地址、每一台电脑仅能享受一次优惠，如发现有违规者我们将保留无限期审核扣回礼品及所产生的利润权利。</li>
                    <li>礼品不能折算为现金，图片仅供于参考作用，礼品以实际收到的为准，东赢对礼品拥有最终解释权。</li>
                    <li>此活动遵循东赢一般规则与条款。</li>
                </ul>
            </div>
        </div>
    </div>
</body>
@@include('html-foot.html')
<script type="text/javascript">
    function getQueryString(name) {
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
    }
    var queryToken = getQueryString("token");
    var headCode = getQueryString("headCode");
    var menuCode = getQueryString("menuCode");
    var memberBet = 0;
    var alreadyGot = false;
    $(document).ready(function() {
        mui.init();
        // 点击确认的时候关闭模态层
        mui(".mui-bar-nav").on('tap','.mui-pull-left',function(){
            window.location.href="/wap/helpbonus/hb_index.html";
        });
        if(headCode==='show'){
            $('.mui-bar.mui-bar-nav').show();
            $('.top-banner').css('margin-top','44px');
        } else if(headCode === 'hide') {
            $('.mui-bar.mui-bar-nav').hide();
        }
        if(menuCode==='hide'){
            $('#menu_nav').hide();
        }
        if(queryToken == null || queryToken === '') {
            queryToken = wap_get_user().token;
        }
        loadGifts();
        var giftsList = $('.gift-container');
        function loadGifts() {
            $.ajax({
                dataType: "jsonp",
                url:event_site_host() + "/eposrts/gifts",
                type:"POST",
                data:{'token': queryToken},
                dataType: 'json',
                success:function(d){
                    if (d.code == 0) {
                        $.each(d.data.gifts, function(i, v) {
                            giftsList.append('<div class="gift-item-box"><div><img src="' + v.imgUrl + '"></div><div class="gift-name">' + v.giftName +'</div><div class="gift-desc">需要流水金额：' + v.requiredPoints +'</div><div class="exchange-btn" data-rpoint="' + v.requiredPoints + '" onclick="exchangeGift(' + v.id + ', ' + v.requiredPoints + ', this)">兑换礼品</div></div>');
                        });
                    } else {
                        fun_alertMsg(d.message, function() {});
                        wap_if_session_out(d.code);
                    }
                },
                error:function(jqXHR, textStatus, errorThrown){
                    wap_check_ajaxerror(jqXHR);
                    fun_alertMsg('礼品列表获取失败，请稍后重试', function() {});
                },
                complete: function() {
                    if((queryToken===null || queryToken===undefined || queryToken==='') && wap_is_user_notexist()) {

                    } else {
                        loadMemberBet();
                    }
                }
            });
        }

        function loadMemberBet() {
            $.ajax({
                dataType: "jsonp",
                url:event_site_host() + "/ptweb/eposrts/memberGiftBet",
                type:"POST",
                data:{'token': queryToken},
                dataType: 'json',
                success:function(d){
                    if (d.code == 0) {
                        alreadyGot = d.data.gotAlready;
                        var vb = d.data.validBet;
                        if(vb) {
                            memberBet = vb;
                            if(vb > 5000000)
                                vb = 5000000;
                            var leftMargin = (vb/5000000*(window.document.documentElement.getBoundingClientRect().width*0.9222)) - (vb/5000000*25);
                            var startBet = {bet: 0};
                            var tween = TweenLite.to(startBet , 2, {
                                bet: vb,
                                onUpdate: showBet
                            });
                            var betSpan = $('.member-valid-bet');
                            function showBet() {
                                betSpan.text(startBet.bet.toFixed(2));
                            }
                            var mbb = $('.member-bet-box');
                            function progressItemActive() {
                                var pi = parseInt((mbb.position().left + 50)/(window.document.documentElement.getBoundingClientRect().width*0.0175));
                                if(pi > 0) {
                                    $('.progress-bar-item').slice(0, pi).addClass('active');
                                }
                            }
                            TweenMax.to(mbb, 2, {
                                x: leftMargin,
                                onUpdate: _.throttle(progressItemActive, 200)
                            });

                            //确定哪个礼品可以领取
                            var itemActive;
                            $('.gift-item-box .exchange-btn').each(function() {
                                if(memberBet >= $(this).data('rpoint')) {
                                    itemActive = $(this);
                                }
                            });
                            if(itemActive) {
                                itemActive.addClass("active");
                            }
                        }
                    } else {
                        fun_alertMsg(d.message, function() {});
                        wap_if_session_out(d.code);
                    }
                },
                error:function(jqXHR, textStatus, errorThrown){
                    wap_check_ajaxerror(jqXHR);
                }
            });
        }
        $('.exchange-record-btn').click(function() {
            location.href = '/wap/promotion/esportsGiftRecord.html?token=' + queryToken + '&headCode=' + headCode + "&menuCode=" + menuCode;
        });
    });
    var giftBeginTime = new Date(2020, 1, 1, 0, 0, 0).getTime();
    function exchangeGift(id, rp, obj) {
        if(new Date().getTime() < giftBeginTime) {
            fun_alertMsg('活动2020年2月1日开始，敬请期待!', function() {});
        } else if(alreadyGot) {
            fun_alertMsg('您本月已经领取过奖品，请下个月再参与', function() {});
        } else if(memberBet < rp) {
            fun_alertMsg('兑换此礼品您还需要' + ((rp - memberBet).toFixed(2)) + '元有效投注额，请继续加油！', function() {});
        } else if(!$(obj).hasClass('active')) {
            fun_alertMsg('只可兑换当前档礼品', function() {});
        } else {
            location.href='/wap/promotion/giftExpress.html?token=' + queryToken + '&headCode=' + headCode + "&menuCode=" + menuCode + "&giftId=" + id;
        }
    }
</script>
</html>